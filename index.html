<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>အာကာစိုး (Smart Pro)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', 'Padauk', sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: pan-x pan-y;
            overflow: hidden;
            background-color: #f8fafc;
        }
        .dark body { background-color: #0f172a; }

        /* Smooth Zoom Container */
        .zoom-container {
            transform-origin: 0 0;
            transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .dark .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Sticky Headers */
        th { position: sticky; top: 0; z-index: 20; }
        .sticky-col { position: sticky; left: 0; z-index: 10; }
        .sticky-corner { position: sticky; top: 0; left: 0; z-index: 30; }

        /* Animations */
        @keyframes floatUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse-highlight { 
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .highlight-active { animation: pulse-highlight 2s infinite; z-index: 5 !important; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }

        /* Floating Menu Transition */
        .fab-menu-enter { transform: scale(0.8) translateY(20px); opacity: 0; }
        .fab-menu-active { transform: scale(1) translateY(0); opacity: 1; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    </style>
</head>
<body class="text-slate-800 dark:text-slate-100 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- PREDICTION LOGIC ENGINE ---
        const PredictionEngine = {
            // 1. Historical Match: What came out on this day in history?
            getHistoryMatches: (data) => {
                const today = new Date();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = today.getDate() > 15 ? '16' : '01'; // Target date
                
                const targetDateSuffix = `-${month}-${day}`;
                return data.filter(item => item.date.endsWith(targetDateSuffix) && item.number)
                           .map(item => ({ year: item.date.split('-')[0], number: item.number }));
            },

            // 2. Frequency Analysis: Top Hits
            getFrequency: (data) => {
                const counts = {};
                data.slice(-50).forEach(d => { // Last 50 draws
                    if(d.number) counts[d.number] = (counts[d.number] || 0) + 1;
                });
                return Object.entries(counts).sort((a,b) => b[1] - a[1]).slice(0, 6);
            },

            // 3. Formula: Simple Pattern (Last digit sum + 1/2 variations)
            getFormulaPredictions: (data) => {
                if (data.length < 3) return [];
                const last = data[data.length - 1]?.number;
                if (!last) return [];
                
                // Simple Logic: Sum of digits of last number
                const sum = last.split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
                const key = sum % 10;
                
                return [
                    { type: "အမြီးပိုင်", val: key },
                    { type: "ခေါင်းစီး", val: (key + 3) % 10 },
                    { type: "ပါဝါ", val: (key + 5) % 10 }
                ];
            }
        };

        const App = () => {
            // State
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [dark, setDark] = useState(false);
            const [zoom, setZoom] = useState(1);
            const [search, setSearch] = useState("");
            const [selectedId, setSelectedId] = useState(null);
            
            // UI State
            const [menuOpen, setMenuOpen] = useState(false);
            const [showPredict, setShowPredict] = useState(false);
            const [activeTool, setActiveTool] = useState(null); // 'edit', 'search', null

            // Refs
            const tableRef = useRef(null);
            
            // Load Data
            useEffect(() => {
                const load = async () => {
                    try {
                        // GitHub Pages or Local Server
                        const res = await fetch('./data.json'); 
                        if (!res.ok) throw new Error("Failed to load");
                        const json = await res.json();
                        setData(json);
                        
                        // Load User Preferences
                        setDark(localStorage.getItem('ks_dark') === 'true');
                    } catch (e) {
                        console.error("Data Load Error:", e);
                        // Fallback mock data if file missing for demo
                        setData([{date: "2024-01-01", number: "123"}]); 
                    } finally {
                        setLoading(false);
                    }
                };
                load();
            }, []);

            // Toggle Dark Mode
            useEffect(() => {
                document.body.className = dark ? 'dark bg-slate-950' : 'bg-slate-50';
                localStorage.setItem('ks_dark', dark);
                if (window.lucide) window.lucide.createIcons();
            }, [dark, menuOpen, showPredict]);

            // Organized Data for Table
            const organized = useMemo(() => {
                const map = {};
                const yearsSet = new Set();
                data.forEach(d => {
                    const date = new Date(d.date);
                    if (isNaN(date)) return;
                    const y = date.getFullYear();
                    yearsSet.add(y);
                    if (!map[y]) map[y] = Array(24).fill(null);
                    
                    // Logic: 1st-15th = Index 0, 2, 4... | 16th-End = Index 1, 3, 5...
                    // Simplified Month Indexing:
                    const m = date.getMonth();
                    const isSecondHalf = date.getDate() > 15;
                    const idx = m * 2 + (isSecondHalf ? 1 : 0);
                    
                    if (idx < 24) map[y][idx] = d.number;
                });
                const years = Array.from(yearsSet).sort((a, b) => a - b);
                return { map, years };
            }, [data]);

            // Prediction Calculation
            const predictions = useMemo(() => {
                if(data.length === 0) return null;
                const history = PredictionEngine.getHistoryMatches(data);
                const freq = PredictionEngine.getFrequency(data);
                const formula = PredictionEngine.getFormulaPredictions(data);
                return { history, freq, formula };
            }, [data, showPredict]);

            // Scroll to Search Result
            useEffect(() => {
                if (search && search.length >= 2) {
                    const match = data.find(d => d.number === search);
                    if (match) {
                        // Find cell logic would go here to scrollIntoView
                        // For demo, we just highlight
                    }
                }
            }, [search]);

            if (loading) return (
                <div className="h-screen flex items-center justify-center flex-col gap-4">
                    <div className="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                    <p className="font-bold text-slate-500 animate-pulse">ဒေတာရယူနေပါသည်...</p>
                </div>
            );

            return (
                <div className="h-screen flex flex-col relative overflow-hidden">
                    {/* 1. TOP HEADER (Minimalist) */}
                    <div className="flex-none h-14 glass-panel z-50 flex items-center justify-between px-4 shadow-sm">
                        <div className="flex items-center gap-3">
                            <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white font-black shadow-lg shadow-blue-500/30">KS</div>
                            <h1 className="font-bold text-lg tracking-tight">Smart Record</h1>
                        </div>
                        <div className="flex gap-2">
                             {search && (
                                <span className="px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-bold animate-pulse">
                                    Searching: {search}
                                </span>
                            )}
                            <button onClick={() => setDark(!dark)} className="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                                <i data-lucide={dark ? "sun" : "moon"} className="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>

                    {/* 2. MAIN DATA TABLE (Zoomable) */}
                    <div className="flex-1 overflow-auto bg-white dark:bg-slate-950 relative" style={{ cursor: 'grab' }}>
                        <div className="zoom-container p-4 min-w-max" style={{ transform: `scale(${zoom})` }}>
                            <table className="border-collapse">
                                <thead>
                                    <tr>
                                        <th className="sticky-corner p-2 text-xs font-bold text-slate-400 bg-white dark:bg-slate-950 border-b border-r dark:border-slate-800">စဉ်</th>
                                        {organized.years.map(y => (
                                            <th key={y} className="p-2 text-sm font-black text-blue-600 bg-white/95 dark:bg-slate-950/95 backdrop-blur border-b dark:border-slate-800 min-w-[60px]">
                                                {y}
                                            </th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody>
                                    {Array.from({ length: 24 }).map((_, rIdx) => (
                                        <tr key={rIdx} className="hover:bg-slate-50 dark:hover:bg-slate-900/50">
                                            <td className="sticky-col p-1 border-r border-b dark:border-slate-800 bg-slate-50 dark:bg-slate-900 text-center">
                                                <div className="text-[10px] font-bold text-slate-400">{rIdx + 1}</div>
                                                <div className="text-[8px] font-bold text-slate-300">{rIdx % 2 === 0 ? '1' : '16'}</div>
                                            </td>
                                            {organized.years.map(y => {
                                                const num = organized.map[y][rIdx];
                                                const id = `${y}-${rIdx}`;
                                                const isMatch = search && num === search;
                                                const isSelected = selectedId === id;

                                                return (
                                                    <td key={y} 
                                                        onClick={() => setSelectedId(id)}
                                                        className={`p-1 border-b border-r border-dashed border-slate-200 dark:border-slate-800 relative transition-all duration-300`}
                                                    >
                                                        <div className={`
                                                            w-12 h-10 flex items-center justify-center rounded-lg text-sm font-bold tracking-tighter transition-all
                                                            ${isMatch ? 'bg-amber-500 text-white highlight-active scale-110 shadow-xl' : ''}
                                                            ${isSelected && !isMatch ? 'ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30' : ''}
                                                            ${!num ? 'bg-slate-50/50 dark:bg-slate-900/50' : ''}
                                                        `}>
                                                            {num || <span className="opacity-10 text-xl">·</span>}
                                                        </div>
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* 3. PREDICTION MODAL (Bottom Sheet) */}
                    {showPredict && predictions && (
                        <div className="absolute inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center p-4 animate-in fade-in duration-200" onClick={() => setShowPredict(false)}>
                            <div className="bg-white dark:bg-slate-900 w-full max-w-md rounded-2xl shadow-2xl border dark:border-slate-800 overflow-hidden flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
                                <div className="p-4 border-b dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
                                    <h2 className="font-bold text-lg flex items-center gap-2">
                                        <i data-lucide="sparkles" className="text-amber-500"></i>
                                        AI ခန့်မှန်းချက်များ
                                    </h2>
                                    <button onClick={() => setShowPredict(false)} className="p-1 rounded-full bg-slate-200 dark:bg-slate-700"><i data-lucide="x" className="w-5 h-5"></i></button>
                                </div>
                                
                                <div className="p-4 overflow-y-auto space-y-6">
                                    {/* Section A: History */}
                                    <div>
                                        <h3 className="text-xs font-black text-slate-400 uppercase mb-2">သမိုင်းဝင် တိုက်ဆိုင်မှုများ (ဒီရက်ပိုင်း)</h3>
                                        <div className="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                                            {predictions.history.length > 0 ? predictions.history.map((h, i) => (
                                                <div key={i} className="flex-shrink-0 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 px-3 py-2 rounded-xl text-center min-w-[70px]">
                                                    <div className="text-[10px] text-slate-500">{h.year}</div>
                                                    <div className="text-lg font-black text-blue-600 dark:text-blue-400">{h.number}</div>
                                                </div>
                                            )) : <p className="text-sm text-slate-500 italic">မှတ်တမ်းမရှိသေးပါ</p>}
                                        </div>
                                    </div>

                                    {/* Section B: Top Hits */}
                                    <div>
                                        <h3 className="text-xs font-black text-slate-400 uppercase mb-2">အထွက်အများဆုံး (Hot Numbers)</h3>
                                        <div className="grid grid-cols-6 gap-2">
                                            {predictions.freq.map(([num, count]) => (
                                                <div key={num} className="bg-slate-100 dark:bg-slate-800 rounded-lg p-1 text-center">
                                                    <div className="font-bold text-slate-800 dark:text-slate-200">{num}</div>
                                                    <div className="text-[9px] text-slate-400">{count}ကြိမ်</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Section C: Formula */}
                                    <div className="bg-slate-900 text-white rounded-2xl p-4 shadow-lg bg-gradient-to-r from-slate-900 to-slate-800">
                                        <div className="flex justify-between items-start mb-3">
                                            <h3 className="font-bold text-amber-400">Master Formula</h3>
                                            <i data-lucide="calculator" className="opacity-50 w-4 h-4"></i>
                                        </div>
                                        <div className="flex justify-between">
                                            {predictions.formula.map((f, i) => (
                                                <div key={i} className="text-center">
                                                    <div className="text-[10px] opacity-70 mb-1">{f.type}</div>
                                                    <div className="text-2xl font-black">{f.val}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 4. SMART FAB MENU (Bottom Right) */}
                    <div className="absolute bottom-6 right-6 z-50 flex flex-col items-end gap-3">
                        {/* Expanded Menu Items */}
                        {menuOpen && (
                            <div className="flex flex-col items-end gap-3 pb-2 fab-menu-active">
                                {/* Search Tool */}
                                <div className="flex items-center gap-2">
                                    {activeTool === 'search' && (
                                        <input 
                                            autoFocus
                                            type="number" 
                                            placeholder="ဂဏန်းရှာ..." 
                                            className="w-32 h-10 rounded-full px-4 shadow-lg border-none outline-none text-center font-bold text-lg"
                                            value={search}
                                            onChange={(e) => setSearch(e.target.value)}
                                        />
                                    )}
                                    <button onClick={() => { setActiveTool(activeTool === 'search' ? null : 'search'); setSearch(""); }} 
                                        className="w-12 h-12 bg-white text-slate-700 rounded-full shadow-lg flex items-center justify-center hover:bg-slate-50 transition-transform hover:scale-110">
                                        <i data-lucide="search" className="w-5 h-5"></i>
                                    </button>
                                </div>

                                {/* Prediction Tool */}
                                <div className="flex items-center gap-2">
                                    <span className="bg-black/70 text-white text-xs px-2 py-1 rounded backdrop-blur">တွက်ချက်ရန်</span>
                                    <button onClick={() => { setShowPredict(true); setMenuOpen(false); }} 
                                        className="w-12 h-12 bg-amber-500 text-white rounded-full shadow-lg shadow-amber-500/40 flex items-center justify-center hover:bg-amber-400 transition-transform hover:scale-110">
                                        <i data-lucide="sparkles" className="w-6 h-6 animate-pulse"></i>
                                    </button>
                                </div>

                                {/* Zoom Reset */}
                                <button onClick={() => setZoom(1)} 
                                    className="w-12 h-12 bg-white text-slate-700 rounded-full shadow-lg flex items-center justify-center">
                                    <span className="font-bold text-xs">100%</span>
                                </button>
                            </div>
                        )}

                        {/* Main FAB Trigger */}
                        <button 
                            onClick={() => setMenuOpen(!menuOpen)}
                            className={`w-16 h-16 rounded-full shadow-2xl flex items-center justify-center transition-all duration-300 ${menuOpen ? 'bg-slate-800 rotate-45' : 'bg-blue-600 hover:scale-105'}`}
                        >
                            <i data-lucide="plus" className="w-8 h-8 text-white"></i>
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
